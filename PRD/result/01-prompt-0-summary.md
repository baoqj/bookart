# Bookart AI 项目状态总结报告

> 报告日期：2026年1月21日
> 当前分支：feature/prompt-0-skeleton

## 一、项目概述

Bookart AI 是一款面向作者的 AI 书籍插图生成器 SaaS 应用。该应用旨在帮助作者在创作过程中自动为书稿生成匹配的插图，大幅降低专业插图的获取门槛。产品的核心价值主张在于：用户无需注册登录即可完成从书稿上传到插图下载的完整工作流程，这种低门槛的设计理念贯穿整个产品设计。

项目采用 Next.js 16 App Router 架构，主代码库位于 `Code2/` 目录中。当前处于 MVP 阶段，核心功能骨架已搭建完成，但 AI 文本分割、图片生成、真实支付等能力仍依赖外部服务集成。开发团队使用 pnpm 作为包管理器，所有依赖均已配置就绪。

## 二、技术架构

### 2.1 技术栈详情

项目选用了当前业界主流且成熟的技术组合。框架层面采用 Next.js 16.0.10 的 App Router 模式，这一选择既保证了服务端渲染的性能优势，又提供了 React 19.2.0 的最新特性支持。类型系统使用 TypeScript 严格模式，为代码的可维护性和重构安全性提供了保障。

UI 层面采用 Tailwind CSS 4.1.9 结合 shadcn/ui 组件库。shadcn/ui 并不是传统的 npm 包分发模式，而是通过复制源代码到项目中的方式提供组件，这种模式让开发者拥有对组件的完全控制权，便于根据业务需求进行深度定制。项目目前已集成了超过 50 个 shadcn/ui 基础组件，涵盖按钮、对话框、表格、导航、反馈等各类常见交互元素。

状态管理层面，项目当前使用 React Context 配合 useState 的简单组合。auth-context.tsx 提供了用户认证状态的全局管理，hooks/use-toast.ts 实现了 Toast 通知系统。这种轻量级的状态管理方案在 MVP 阶段足够使用，但文档建议在后续迭代中考虑引入 Zustand 以应对更复杂的全局状态需求。

表单处理采用 react-hook-form 配合 zod 验证规则，这一组合是 React 生态中表单处理的事实标准，能够有效减少表单状态管理的代码复杂度，同时提供良好的类型安全保障。

### 2.2 目录结构

```
Code2/
├── app/                                    # Next.js App Router
│   ├── (auth)/                            # 认证页面组（共享 layout）
│   │   └── auth/
│   │       ├── sign-in/page.tsx           # 登录页
│   │       ├── sign-up/page.tsx           # 注册页
│   │       └── forgot/page.tsx            # 忘记密码页
│   ├── (app)/                             # 认证后的主应用
│   │   └── app/
│   │       ├── projects/                  # 项目管理模块
│   │       │   ├── page.tsx               # 项目列表
│   │       │   └── new/page.tsx           # 创建项目
│   │       ├── credits/page.tsx           # 积分系统
│   │       ├── account/page.tsx           # 账户设置
│   │       └── admin/page.tsx             # 管理员面板
│   ├── (marketing)/                       # 营销落地页
│   │   └── page.tsx                       # 首页
│   ├── dashboard/                         # 旧版仪表板（待整合）
│   └── layout.tsx                         # 根布局
├── components/
│   ├── ui/                                # shadcn/ui 组件库
│   ├── auth-guard.tsx                     # 认证保护高阶组件
│   ├── theme-provider.tsx                 # 主题切换提供者
│   ├── app-sidebar.tsx                    # 主应用侧边栏
│   └── app-header.tsx                     # 主应用头部
├── lib/                                   # 工具库
│   ├── api.ts                             # Mock API 客户端
│   ├── types.ts                           # TypeScript 类型定义
│   ├── mock-data.ts                       # 模拟数据
│   ├── auth-context.tsx                   # 认证上下文
│   ├── utils.ts                           # 工具函数
│   └── i18n.tsx                           # 国际化配置
└── hooks/                                 # React Hooks
    ├── use-toast.ts                       # Toast 通知
    └── use-mobile.ts                      # 移动端检测
```

### 2.3 路由架构

项目采用 Next.js 16 的 Route Groups 语法组织路由结构。（auth）路由组包含登录、注册、忘记密码三个认证相关页面，它们共享一个独立的 layout 布局，提供统一的视觉风格。（app）路由组则是认证后的主应用区域，通过 auth-guard.tsx 组件进行访问控制。营销落地页位于（marketing）路由组中，作为用户首次访问的入口页面。

值得注意的是，app/dashboard/ 目录与 app/(app)/app/ 功能存在重复，这是项目早期迭代留下的技术债务，需要在后续版本中进行路由整合。整合的方向应该是废弃 dashboard 目录，统一使用 (app) 路由组下的页面。

## 三、核心数据模型

### 3.1 类型定义（lib/types.ts）

项目定义了一套完整的数据模型，覆盖了从用户管理到插图生成的完整业务链路。User 类型包含用户的核心信息，其中 role 字段用于区分普通用户和管理员，credits 字段记录用户的积分余额，language 字段支持用户偏好的界面语言。

Project 类型代表用户的项目实体，manuscriptStatus 字段追踪书稿的处理状态，paragraphCount 字段记录段落数量。这些字段共同构成了项目详情页展示的数据基础。

Paragraph 类型是书稿解析的核心模型，content 存储段落文本内容，index 表示段落顺序，markedForIllustration 标记该段落是否需要生成插图。这一设计支持用户选择部分段落进行插图生成，而非强制为所有内容生成插图。

GenerationTask 类型追踪插图生成任务的生命周期，其 status 字段支持四种状态：queued（排队中）、running（生成中）、succeeded（成功）、failed（失败）。这种状态机的设计便于前端展示任务进度和处理各种边界情况。

### 3.2 插图配置模型

插图生成支持丰富的配置选项，这些配置通过 IllustrationSettings 类型进行约束。StylePreset 枚举定义了六种预设风格：儿童故事（children-story）、历史（history）、教育（education）、建筑（architecture）、政府（government）、文化（culture）。ColorMode 枚举提供四种色彩模式选择。BrushStyle 枚举定义了四种画笔风格。AspectRatio 和 ImageSize 则分别控制输出图片的尺寸规格。

## 四、已实现功能

### 4.1 用户认证模块

认证模块采用 Mock 方式实现，通过 auth-api 提供登录、注册、登出、获取当前用户、忘记密码等核心功能。模拟认证的特殊规则是：邮箱地址中包含 "admin" 字符串的用户将自动获得管理员权限。这一设计便于开发测试管理员功能，无需繁琐的注册流程。

auth-guard.tsx 组件实现了页面级的访问控制，它包裹在主应用的 layout 中，会检查用户的登录状态，未登录用户将被重定向到登录页面。值得注意的是，文档指出 MVP 阶段产品支持未登录访问，这一设计决策与 auth-guard 的行为存在潜在冲突，需要进一步明确产品策略。

### 4.2 项目管理模块

项目管理是用户操作的核心入口。projects-api 提供了完整的项目 CRUD 操作，包括项目列表查询、项目详情获取、项目创建、项目更新、项目删除。页面层面实现了项目列表展示和新建项目两个核心页面。

项目列表页面采用响应式布局，支持在不同屏幕尺寸下正常展示。每个项目卡片展示项目标题、描述、语言、书稿状态等关键信息。项目创建页面通过表单收集项目基本信息，支持用户快速开启新项目。

项目详情页面采用了 Tabs 导航设计，将书稿管理和插图生成两个功能模块组织在一起。这种设计让用户可以在同一页面内完成从书稿处理到插图生成的完整工作流，交互路径清晰合理。

### 4.3 书稿导入与段落管理

manuscript 模块是产品工作流的第一步。用户可以通过两种方式导入书稿：直接粘贴文本内容，或通过拖拽交互上传 .txt 文件。文本导入后，系统使用换行符双换行符（\n\n）进行简单的段落分割。这一分割逻辑目前是硬编码的，文档指出后续需要接入 AI 服务进行智能文本分割。

段落列表页面支持多选交互，用户可以勾选需要生成插图的段落。选中段落的预览会在侧边面板实时展示，方便用户确认选择的内容是否正确。每段落旁都有复选框标记是否需要插图，这一状态会持久化到后端同步。

### 4.4 插图配置与生成

illustrations 模块处理插图生成的核心逻辑。用户在段落选择完成后，进入插图设置页面进行风格配置。配置项包括风格预设、色彩模式、画笔风格、纵横比、图片尺寸等多个维度。

生成任务通过 illustrations-api 创建，系统会返回一个任务 ID 用于追踪进度。任务状态采用轮询方式获取，页面会展示当前任务的排队位置、生成进度、成功或失败状态。生成完成后，插图以瀑布流网格布局展示，支持单张预览、重新生成、修改设置、下载等操作。

批量操作也是重要的功能点，用户可以选中多张插图进行批量打包下载，或批量重新生成。这一设计符合用户在实际工作中批量处理插图的需求场景。

### 4.5 积分系统

credits 模块实现了虚拟积分经济系统的核心功能。credits-api 提供查询余额、查询交易历史、购买积分三项核心能力。积分交易类型包括四种：earn（获取）、spend（消耗）、refund（退款）、purchase（购买）。

积分页面包含余额卡片、交易账本、购买弹窗三个核心组件。余额卡片展示当前积分余额和所购套餐信息。交易账本以时间线形式展示所有积分变动记录，每条记录包含时间、类型、金额、原因、关联 ID 等信息。购买弹窗提供 100、500、2000 三个积分包选项，目前仅实现 UI 层面的交互，未对接真实支付网关。

低积分警告机制会在用户余额不足时显示提示横幅，提醒用户及时购买积分以继续使用服务。

### 4.6 账户与管理功能

account 页面是用户个人设置的入口，提供基本的账户信息展示和语言偏好设置。admin 页面目前仅实现基础的占位结构，功能待后续开发。admin-api 提供了用户搜索、用户信息查询、积分调整三项管理员操作接口，为后续管理功能的实现预留了空间。

### 4.7 UI 组件与主题

项目集成了完整的 shadcn/ui 组件库，覆盖表单元素、对话框、导航、数据展示、用户反馈等各类场景。所有页面都遵循 loading、empty、error 三种状态的展示规范，使用 Skeleton 组件提供加载占位，lucide-react 图标库为空状态提供视觉引导。

主题系统通过 next-themes 实现，支持明暗主题切换。配色方案选用明亮柔和的色调，区别于传统的黑白冷色调设计风格，这一选择与产品定位的亲切易用感相呼应。

## 五、Mock API 覆盖范围

项目当前使用 lib/api.ts 中的 Mock API 模拟后端服务响应。这种设计让前端开发可以在后端服务就绪之前独立进行，也便于进行各种边界情况的测试。

所有 Mock API 函数都包含 200ms 到 1200ms 不等的模拟网络延迟，这一设计让前端开发可以真实地体验异步加载流程，而非收到同步的即时响应。延迟时间在不同的 API 方法间略有差异，模拟真实世界中不同接口的响应速度差异。

API 模块的划分清晰合理，auth-api 处理认证相关请求，projects-api 处理项目 CRUD，manuscript-api 处理书稿操作，illustrations-api 处理插图生成，credits-api 处理积分业务，admin-api 处理管理功能。这种模块化的组织方式便于后续用真实服务替换 Mock 实现，也便于单元测试的编写。

## 六、测试状态

### 6.1 当前测试覆盖情况

项目当前未包含任何测试文件。代码库中未发现 *.test.ts、*.test.tsx、*.spec.ts 等测试文件。这一情况在 MVP 阶段虽然可以接受，但随着功能迭代和团队规模扩大，测试覆盖的缺失会成为质量风险的重要来源。

### 6.2 建议测试策略

对于当前项目结构，建议按优先级补充以下测试：

第一层是组件单元测试，重点覆盖 auth-guard.tsx 的路由跳转逻辑、主题切换功能、表单验证规则等核心业务逻辑。第二层是 API Mock 层的集成测试，验证各 API 模块的数据处理逻辑和错误处理逻辑。第三层是页面级的 E2E 测试，覆盖核心用户路径：登录 → 创建项目 → 导入书稿 → 选择段落 → 配置插图 → 生成下载。

测试框架的选择上，建议使用 Vitest 作为单元测试框架（与 Next.js 项目兼容性良好），Playwright 作为 E2E 测试框架（API 简洁、社区活跃）。

### 6.3 构建与功能测试结果

根据项目现有测试报告，构建测试已通过 TypeScript 编译，无构建错误，无类型错误，12 个路由生成成功。功能测试验证了所有页面可访问，导航功能正常，响应式布局正常，主题切换正常，控制台无错误。性能测试指标显示编译时间约 1.2 秒，首次加载小于 2 秒，页面切换小于 100 毫秒。

## 七、已知问题与技术债务

### 7.1 需立即处理的问题

next.config.mjs 中设置了 typescript.ignoreBuildErrors: true，这一配置会忽略 TypeScript 编译错误，虽然方便开发阶段的临时绕过，但绝对不应该带入生产环境。需要在上线前移除该配置并修复所有类型错误。

dashboard/ 目录与 (app)/ 路由组存在功能重复，两个入口都会导向类似的页面结构，但代码组织方式不同。这一技术债务需要通过路由整合来解决，明确统一的页面入口。

### 7.2 待功能完善项

文件上传功能（.txt 文件）UI 已实现但功能未完全打通，用户拖拽文件后没有实际的上传逻辑响应。AI 文本分割当前使用硬编码的 \n\n 分割规则，无法实现智能段落识别。图片生成 API 处于 Mock 状态，生成结果为预设图片而非真实 AI 生成。

真实支付集成未实现，积分购买仅是 UI 交互。国际化框架虽然预留了 i18n.tsx，但完整的多语言切换并未生效。登录态与 MVP 支持未登录访问的产品策略存在冲突，需要明确产品边界。

## 八、后续集成路线

项目从当前 MVP 状态过渡到可上线产品，需要完成以下关键集成：

接入真实的 AI 文本分割服务，替换当前的简单换行分割逻辑。这一服务可以调用 OpenAI GPT 系列模型，或使用专门的文本处理 API。关键指标是段落识别的准确率和单次请求处理的文本量上限。

接入真实的图片生成 API，可选方案包括 Stable Diffusion（自托管或云服务）、DALL-E 3、Midjourney API 等。需要考虑成本控制、生成速度、图像质量等多个维度的平衡。

实现真实的用户认证方案，可选方案包括 Clerk（托管认证服务）、NextAuth.js（自托管方案）。Clerk 的优势在于集成快速、UI 组件丰富，NextAuth 的优势在于完全可控、无供应商锁定。

集成 Stripe 支付网关处理真实的积分购买交易。需要配置 Webhook 处理支付成功回调，确保积分余额的准确发放。

## 九、总结

Bookart AI 项目已完成核心功能骨架的搭建，技术架构合理、代码组织清晰、Mock API 覆盖完整。从项目初始化到当前状态，开发团队高效地完成了认证、项目管理、书稿处理、插图生成、积分系统等核心模块的实现。

项目当前处于功能就绪但未对接真实服务的状态，这是 MVP 阶段的典型特征。下一步的开发重点应聚焦于：移除 TypeScript 构建忽略配置、整合重复路由、补充测试覆盖、接入真实服务。整体而言，项目基础扎实，具备良好的后续迭代条件。

## 附录：文件清单

| 文件类型 | 数量 | 说明 |
|---------|------|------|
| TypeScript/TSX 文件 | 27+ | 包含页面、组件、类型定义 |
| API 模块 | 6 个 | auth、projects、manuscript、illustrations、credits、admin |
| 数据模型 | 7 个 | User、Project、Paragraph、GenerationTask 等 |
| shadcn/ui 组件 | 50+ | 基础 UI 组件库 |
| 文档文件 | 3 份 | 测试报告、部署指南、开发总结 |
| 测试框架 | 待配置 | 建议 Vitest + Playwright |
